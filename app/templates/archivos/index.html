{% extends "layout.html" %}
{% block content %}
<h1 class="page-title">Evidencias</h1>

<form method="post" action="{{ url_for('archivos_bp.upload') }}" enctype="multipart/form-data" class="section">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
  <input type="file" name="file" required>
  {% if parte_id %}<input type="hidden" name="parte_id" value="{{ parte_id }}">{% endif %}
  {% if run_id %}<input type="hidden" name="run_id" value="{{ run_id }}">{% endif %}
  <button class="btn" type="submit">Subir</button>
</form>

<table class="table">
  <thead>
    <tr>
      <th>Nombre</th>
      <th>Tamaño</th>
      <th>Vínculo</th>
      <th style="text-align:right">Acciones</th>
    </tr>
  </thead>
  <tbody>
    {% for item in archivos %}
    <tr>
      <td>{{ item.name }}</td>
      <td>{{ item.size_kb }} KB</td>
      <td>{{ item.label }}</td>
      <td style="text-align:right">
        <a class="btn" href="{{ url_for('archivos_bp.download', attachment_id=item.id) }}">Descargar</a>
        <form method="post" action="{{ url_for('archivos_bp.delete', attachment_id=item.id) }}" style="display:inline" onsubmit="return confirm('¿Eliminar archivo?')">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          {% if parte_id %}<input type="hidden" name="parte_id" value="{{ parte_id }}">{% endif %}
          {% if run_id %}<input type="hidden" name="run_id" value="{{ run_id }}">{% endif %}
          <button class="btn" type="submit">Eliminar</button>
        </form>
      </td>
    </tr>
    {% else %}
    <tr>
      <td colspan="4" class="muted">Sin archivos</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
