{% extends "base.html" %}
{% block content %}
<h1>Dashboard</h1>

<!-- Atajos -->
{% if DEV_MODE %}
<p>
  <a href="{{ url_for('checklists.nuevo') }}">âž• Nuevo Checklist</a> |
  <a href="{{ url_for('partes.nuevo') }}">âž• Nuevo Parte</a> |
  <a href="{{ url_for('equipos_bp.nuevo') }}">âž• Nuevo Equipo</a>
  {% if total_operadores is not none %}| <a href="{{ url_for('operadores.nuevo') }}">âž• Nuevo Operador</a>{% endif %}
</p>
{% endif %}

<!-- KPIs -->
<div style="display:flex; gap:16px; flex-wrap:wrap;">
  <div style="border:1px solid #ddd; padding:12px; border-radius:8px; min-width:180px;">
    <div>Total Equipos</div>
    <h2>{{ total_equipos }}</h2>
  </div>
  <div style="border:1px solid #ddd; padding:12px; border-radius:8px; min-width:180px;">
    <div>Total Operadores</div>
    <h2>{{ total_operadores }}</h2>
  </div>
  <div style="border:1px solid #ddd; padding:12px; border-radius:8px; min-width:220px;">
    <div>Partes de hoy ({{ hoy }})</div>
    <h2>{{ partes_count }}</h2>
    <small>Horas: {{ '%.2f'|format(horas_hoy) }} &nbsp;â€¢&nbsp; Comb: {{ '%.2f'|format(comb_hoy) }} L</small>
  </div>
  <div style="border:1px solid #ddd; padding:12px; border-radius:8px; min-width:220px;">
    <div>Checklists de hoy ({{ hoy }})</div>
    <h2>APTO {{ chk_apto }} / NO_APTO {{ chk_noapto }}</h2>
  </div>
</div>

<!-- Alertas -->
<h2 style="margin-top:24px;">Alertas</h2>
<div style="display:flex; gap:16px; flex-wrap:wrap;">
  <div style="border:1px solid #f2c; padding:12px; border-radius:8px; min-width:300px;">
    <h3 style="margin:0 0 8px 0;">NO_APTO (Ãºltimos 3 dÃ­as)</h3>
    {% if noaptos %}
    <ul>
      {% for c in noaptos %}
        <li>
          {{ c.date }} â€” {{ c.template.name }} â€” <b>{{ c.overall_status }}</b>
          <a href="{{ url_for('checklists.detalle', cl_id=c.id) }}">ver</a>
        </li>
      {% endfor %}
    </ul>
    {% else %}
    <p>Sin NO_APTO recientes ðŸŽ‰</p>
    {% endif %}
  </div>

  <div style="border:1px solid #fc6; padding:12px; border-radius:8px; min-width:300px;">
    <h3 style="margin:0 0 8px 0;">Partes de hoy incompletos</h3>
    {% if partes_incompletos %}
    <ul>
      {% for p in partes_incompletos %}
        <li>
          Parte #{{ p.id }} â€” Equipo {{ p.equipo_id }}
          {% if p.horas_trabajadas is none %} â€¢ falta <b>horas</b>{% endif %}
          {% if p.combustible_l is none %} â€¢ falta <b>combustible</b>{% endif %}
          {% if DEV_MODE %}<a href="{{ url_for('partes.editar', parte_id=p.id) }}">editar</a>{% endif %}
        </li>
      {% endfor %}
    </ul>
    {% else %}
    <p>Todos los partes de hoy estÃ¡n completos âœ…</p>
    {% endif %}
  </div>
</div>
{% endblock %}
