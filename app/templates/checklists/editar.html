{% extends "base.html" %}
{% block content %}
<h1>Checklist — {{ cl.template.name }} / {{ cl.overall_status }}</h1>
<form method="post" action="{{ url_for('checklists.guardar', cl_id=cl.id) }}" enctype="multipart/form-data">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
  {% for section, items in items_by_section.items() %}
    <h2>{{ "Pre-operativo" if section == "PRE" else ("Operación" if section == "OP" else "Post-operativo") }}</h2>
    <table>
      <thead>
        <tr><th>#</th><th>Ítem</th><th>Resultado</th><th>Nota</th><th>Foto</th></tr>
      </thead>
      <tbody>
      {% for it in items %}
        {% set ans = answers.get(it.id) %}
        <tr>
          <td>{{ it.order }}</td>
          <td>{{ it.text }} {% if it.critical %}<strong>(Crítico)</strong>{% endif %}</td>
          <td>
            <select name="item_{{ it.id }}">
              {% for v in ['OK', 'FAIL', 'NA'] %}
                <option value="{{ v }}" {{ 'selected' if ans and ans.result.value == v else '' }}>{{ v }}</option>
              {% endfor %}
            </select>
          </td>
          <td><input name="note_{{ it.id }}" value="{{ ans.note if ans else '' }}"></td>
          <td><input type="file" name="photo_{{ it.id }}"></td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  {% endfor %}
  <button type="submit">Guardar</button>
</form>
{% endblock %}
