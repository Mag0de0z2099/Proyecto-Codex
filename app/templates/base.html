<!doctype html>
<html lang="es" data-theme="">
{% import "_icons.html" as i %}
{% import "_forms.html" as forms %}
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}SGC ‚Äî Obra de Dragado{% endblock %}</title>
  {% if DEV_MODE %}
  <meta name="robots" content="noindex,nofollow">
  {% endif %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}">
</head>
<body>
  {% if DEV_MODE %}
  <div class="dev-banner">DEV MODE ‚Äî security disabled</div>
  <style>
    .dev-banner{
      position:fixed; top:0; left:0; right:0;
      background:#FBBF24; color:#111;
      font:600 14px/1.1 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      text-align:center; padding:8px 10px; z-index:9999;
      box-shadow:0 1px 3px rgba(0,0,0,.2)
    }
    /* Evita que el banner tape el contenido */
    body { padding-top: 44px; }
  </style>
  {% endif %}
  <header class="nav">
    <div class="nav-left">
      <span class="brand">
        <span class="logo-text" aria-hidden="true">S21</span>
        <span class="brand-name">SGC-Obra</span>
      </span>
      <nav class="nav-links">
        {% if current_user.is_authenticated %}
          {% if DEV_MODE %}
          <a href="{{ url_for('dashboard.index') }}">Dashboard</a>
          {% endif %}
          <a href="{{ url_for('equipos_bp.index') }}">Equipos</a>
          <a href="{{ url_for('partes.index') }}">Partes</a>
          <a href="{{ url_for('checklists_bp.templates_index') }}">Checklists</a>
          {% if DEV_MODE %}
          <a href="{{ url_for('checklists_bp.ejecutar') }}">Ejecutar</a>
          <a href="{{ url_for('checklists_bp.runs_index') }}">Ejecuciones</a>
          <a href="{{ url_for('partes.resumen') }}">Resumen Partes</a>
          {% endif %}
          <a href="{{ url_for('operadores_bp.index') }}">Operadores</a>
        {% else %}
          <a href="{{ url_for('public.home') }}">Inicio</a>
        {% endif %}
      </nav>
    </div>
    <div class="nav-actions">
      <button id="theme-toggle" class="btn nav-theme" type="button" title="Cambiar tema">üåô</button>
      {% if current_user.is_authenticated %}
      <form method="post" action="{{ url_for('auth.logout') }}" class="inline">
        {{ forms.csrf_field() }}
        <button class="btn" type="submit">Logout</button>
      </form>
      {% else %}
        {% if not DEV_MODE %}
        <a href="{{ url_for('auth.login') }}" class="btn">Login</a>
        {% endif %}
      {% endif %}
    </div>
  </header>

  <main class="container">
    {% if current_user.is_authenticated %}
      <nav>
        <a href="{{ url_for('dashboard.index') }}">Dashboard</a> |
        <a href="{{ url_for('equipos_bp.index') }}">Equipos</a> |
        <a href="{{ url_for('operadores_bp.index') }}">Operadores</a> |
        <a href="{{ url_for('checklists_bp.templates_index') }}">Checklists</a>
        {% if DEV_MODE %}|
        <a href="{{ url_for('checklists_bp.ejecutar') }}">Ejecutar</a> |
        <a href="{{ url_for('checklists_bp.runs_index') }}">Ejecuciones</a>
        {% endif %} |
        <a href="{{ url_for('partes.index') }}">Partes</a>
        {% if DEV_MODE %}|
        <a href="{{ url_for('partes.resumen') }}">Resumen Partes</a>
        {% endif %}
      </nav>
      <hr>
    {% endif %}
    {% if current_user.is_authenticated and (current_user.is_approved is defined) and not current_user.is_approved %}
      <div class="alert alert-warning" role="status">
        Tu cuenta a√∫n no ha sido aprobada. Algunas secciones pueden estar bloqueadas.
      </div>
    {% endif %}
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-stack">
          {% for category, message in messages %}
            <div class="flash {{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </main>

  <footer class="footer">
    <small>¬© 2025 SGC ‚Äî Control de Calidad y Seguridad en Obra de Dragado</small>
  </footer>
  <script>
    (function(){
      const root = document.documentElement;
      const btn = document.getElementById('theme-toggle');

      function apply(theme){
        root.dataset.theme = theme;
        btn.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        try { localStorage.setItem('theme', theme); } catch (e) {}
      }

      let saved = null;
      try { saved = localStorage.getItem('theme'); } catch (e) {}
      const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
      apply(saved || (prefersLight ? 'light' : 'dark'));

      btn.addEventListener('click', function(){
        const next = root.dataset.theme === 'light' ? 'dark' : 'light';
        apply(next);
      });
    })();
  </script>
</body>
</html>
