<!doctype html>
<html lang="es">
{% import "_icons.html" as i %}
{% import "_forms.html" as forms %}
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}SGC — Obra de Dragado{% endblock %}</title>
  {% if DEV_MODE %}
  <meta name="robots" content="noindex,nofollow">
  {% endif %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}">
</head>
<body>
  {% if DEV_MODE %}
  <div class="dev-banner">DEV MODE — security disabled</div>
  <style>
    .dev-banner{
      position:fixed; top:0; left:0; right:0;
      background:#FBBF24; color:#111;
      font:600 14px/1.1 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      text-align:center; padding:8px 10px; z-index:9999;
      box-shadow:0 1px 3px rgba(0,0,0,.2)
    }
    /* Evita que el banner tape el contenido */
    body { padding-top: 44px; }
  </style>
  {% endif %}
  <header class="navbar">
    <div class="nav-left">
      <span class="brand">
        <img class="logo" src="{{ url_for('static', filename='img/siglo21.png') }}" alt="Siglo 21">
        <span>SGC-Obra</span>
      </span>
    </div>
    <nav class="nav-right">
      {% if current_user.is_authenticated %}
        <a href="{{ url_for('equipos_bp.index') }}">Equipos</a>
        <a href="{{ url_for('partes.index') }}">Partes</a>
        <a href="{{ url_for('checklists.index') }}">Checklists</a>
        <a href="{{ url_for('operadores.index') }}">Operadores</a>
        <form method="post" action="{{ url_for('auth.logout') }}" class="inline">
          {{ forms.csrf_field() }}
          <button class="btn" type="submit">Logout</button>
        </form>
      {% else %}
        <a href="{{ url_for('public.home') }}">Inicio</a>
        {% if not DEV_MODE %}
        <a href="{{ url_for('auth.login') }}" class="btn">Login</a>
        {% endif %}
      {% endif %}
    </nav>
  </header>

  <main class="container">
    {% if current_user.is_authenticated %}
      <nav>
        <a href="{{ url_for('dashboard.home') }}">Inicio</a> |
        <a href="{{ url_for('equipos_bp.index') }}">Equipos</a> |
        <a href="{{ url_for('operadores.index') }}">Operadores</a> |
        <a href="{{ url_for('checklists.index') }}">Checklists</a> |
        <a href="{{ url_for('partes.index') }}">Partes</a>
      </nav>
      <hr>
    {% endif %}
    {% if current_user.is_authenticated and (current_user.is_approved is defined) and not current_user.is_approved %}
      <div class="alert alert-warning" role="status">
        Tu cuenta aún no ha sido aprobada. Algunas secciones pueden estar bloqueadas.
      </div>
    {% endif %}
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-stack">
          {% for category, message in messages %}
            <div class="flash {{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
    {% block content %}{% endblock %}
  </main>

  <footer class="footer">
    <small>© 2025 SGC — Control de Calidad y Seguridad en Obra de Dragado</small>
  </footer>
</body>
</html>
