{% extends "base.html" %}
{% import "_forms.html" as forms %}
{% block content %}
<h1>Parte — {{ p.fecha }} — Equipo {{ p.equipo.codigo if p.equipo else p.equipo_id }}</h1>
{% if p.checklist_id %}
  <p>Origen: Checklist <a href="{{ url_for('checklists.detalle', cl_id=p.checklist_id) }}">#{{ p.checklist_id }}</a></p>
{% endif %}
<p>Turno: {{ p.turno }} | Ubicación: {{ p.ubicacion or '-' }} | Clima: {{ p.clima or '-' }}</p>
<p>
  Horas: {{ p.horas_inicio or '-' }} → {{ p.horas_fin or '-' }}
  (Trabajadas: {{ '%.2f'|format(p.horas_trabajadas) if p.horas_trabajadas is not none else '-' }})
  | Comb (L): {{ '%.2f'|format(p.combustible_l) if p.combustible_l is not none else '-' }}
</p>
<p>Operador: {{ p.operador.nombre if p.operador else '-' }}</p>
<p>Observaciones: {{ p.observaciones or '-' }}</p>
<p>
  {% if DEV_MODE %}
    <a class="btn" href="{{ url_for('partes.editar', parte_id=p.id) }}">Editar</a>
    <form method="post" action="{{ url_for('partes.eliminar', parte_id=p.id) }}" style="display:inline" onsubmit="return confirm('¿Eliminar parte?');">
      {{ forms.csrf_field() }}
      <button type="submit">Eliminar</button>
    </form>
  {% endif %}
  <button onclick="window.print()">Imprimir</button>
  <a class="btn" href="{{ url_for('partes.index') }}">Volver al listado</a>
</p>

<h2>Actividades</h2>
<table class="table">
  <thead><tr><th>Descripción</th><th>Cant</th><th>Unidad</th><th>Horas</th><th>Notas</th></tr></thead>
  <tbody>
    {% for a in actividades %}
      <tr>
        <td>{{ a.descripcion }}</td>
        <td>{{ '%.2f'|format(a.cantidad) if a.cantidad is not none else '-' }}</td>
        <td>{{ a.unidad or '-' }}</td>
        <td>{{ '%.2f'|format(a.horas) if a.horas is not none else '-' }}</td>
        <td>{{ a.notas or '' }}</td>
      </tr>
    {% else %}
      <tr><td colspan="5">Sin actividades registradas.</td></tr>
    {% endfor %}
  </tbody>
  <tfoot>
    <tr>
      <th>Total</th>
      <th>{{ '%.2f'|format(total_prod) }}</th>
      <th></th>
      <th>{{ '%.2f'|format(total_horas_acts) }}</th>
      <th></th>
    </tr>
  </tfoot>
</table>
{% endblock %}
