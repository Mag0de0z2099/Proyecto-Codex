{% extends "admin/_base_admin.html" %}
{% import "_icons.html" as i %}
{% block admin_title %}Bitácoras · Admin · SGC{% endblock %}
{% block admin_content %}
<h1>Bitácoras</h1>

<form method="post" action="{{ url_for('admin.bitacoras_create') }}">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
  <div class="form-grid">
    <select name="project_id" required aria-label="Proyecto">
      <option value="">Proyecto…</option>
      {% for p in projects %}<option value="{{ p.id }}">{{ p.name }}</option>{% endfor %}
    </select>

    <input type="text" name="author" placeholder="Autor (opcional)" aria-label="Autor">
    <input type="date" name="date" value="{{ default_date }}" aria-label="Fecha">
    <textarea name="text" placeholder="Descripción…" aria-label="Descripción" required></textarea>

    <button type="submit" class="btn btn-primary btn-wide" title="Guardar bitácora">
      {{ i.save() }} <span>Guardar bitácora</span>
    </button>
  </div>
</form>

<table class="table">
  <thead><tr><th>Fecha</th><th>Proyecto</th><th>Autor</th><th>Texto</th></tr></thead>
  <tbody>
    {% for b in logs %}
    <tr>
      <td>{{ b.date }}</td>
      <td>{{ b.project.name }}</td>
      <td>{{ b.author or "-" }}</td>
      <td>{{ b.text[:140] }}{% if b.text|length>140 %}…{% endif %}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
