{% extends "admin/_base_admin.html" %}
{% block admin_content %}
<h1>Invitaciones</h1>

<form method="post" action="{{ url_for('admin.invites_create') }}" class="form-grid" style="grid-template-columns:2fr 1fr 1fr 1fr 1fr;">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
  <input name="email" placeholder="email (opcional)">
  <select name="role">
    <option value="viewer">viewer</option>
    <option value="supervisor">supervisor</option>
    <option value="admin">admin</option>
  </select>
  <input name="category" placeholder="categoría (opcional)">
  <input name="days" type="number" value="7" min="1" aria-label="días">
  <input name="max_uses" type="number" value="1" min="1" aria-label="usos">
  <button class="btn btn-primary">Crear</button>
</form>

<div class="table-grid header-6" style="margin-top:12px">
  <div class="th">Token/Enlace</div>
  <div class="th">Email</div>
  <div class="th">Rol</div>
  <div class="th">Usos</div>
  <div class="th">Expira</div>
  <div class="th">Acciones</div>
  {% for inv in invites %}
    <div style="word-break:break-all">
      /auth/register?token={{ inv.token }}
    </div>
    <div>{{ inv.email or '—' }}</div>
    <div>{{ inv.role }}</div>
    <div>{{ inv.used_count }}/{{ inv.max_uses }}</div>
    <div>{{ inv.expires_at or '—' }}</div>
    <div>
      {% if inv.is_active %}
        <form method="post" action="{{ url_for('admin.invites_revoke', invite_id=inv.id) }}">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button class="btn btn-outline">Revocar</button>
        </form>
      {% else %}
        inactiva
      {% endif %}
    </div>
  {% endfor %}
</div>
{% endblock %}
